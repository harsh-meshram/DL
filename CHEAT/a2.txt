#!/usr/bin/env python
# coding: utf-8

import tensorflow as tf
from tensorflow.keras.applications import VGG16
from tensorflow.keras import layers, models
import matplotlib.pyplot as plt


(x_train, y_train), (x_test, y_test) = tf.keras.datasets.cifar10.load_data()


x_train, x_test = x_train / 255.0, x_test / 255.0
y_train = tf.keras.utils.to_categorical(y_train, 10)
y_test = tf.keras.utils.to_categorical(y_test, 10)


base_model = VGG16(weights="imagenet", include_top=False, input_shape=(32, 32, 3))


for layer in base_model.layers:
    layer.trainable = False


model = models.Sequential([
    base_model,
    layers.Flatten(),
    layers.Dense(256, activation="relu"),
    layers.Dropout(0.5),
    layers.Dense(10, activation="softmax")
])


model.compile(optimizer="adam",
              loss="categorical_crossentropy",
              metrics=["accuracy"])


history = model.fit(x_train, y_train, epochs=5, 
                    validation_data=(x_test, y_test))


for layer in base_model.layers[-4:]:
    layer.trainable = True


model.compile(optimizer=tf.keras.optimizers.Adam(1e-5),
              loss="categorical_crossentropy",
              metrics=["accuracy"])


history_fine = model.fit(x_train, y_train, epochs=5,
                         validation_data=(x_test, y_test))



test_loss, test_acc = model.evaluate(x_test, y_test, verbose=2)
print("\nTest accuracy after fine-tuning:", test_acc)




